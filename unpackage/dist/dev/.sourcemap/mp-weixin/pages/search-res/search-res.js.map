{"version":3,"sources":["uni-app:///main.js","webpack:///D:/My-Document/projects/WanBig/pages/search-res/search-res.vue?d550","webpack:///D:/My-Document/projects/WanBig/pages/search-res/search-res.vue?6bb5","webpack:///D:/My-Document/projects/WanBig/pages/search-res/search-res.vue?7424","webpack:///D:/My-Document/projects/WanBig/pages/search-res/search-res.vue?b77a","uni-app:///pages/search-res/search-res.vue","webpack:///D:/My-Document/projects/WanBig/pages/search-res/search-res.vue?ae86"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","renderjs","component","options","__file","components","render","_vm","this","_h","$createElement","g0","_self","_c","resArr","length","$mp","data","Object","assign","$root","recyclableRender","staticRenderFns","_withStripped","VanIcon","categoryOption","icon","text","value","sortOption","categoryDefault","sortDefault","searchKey","resArrTemp","page","nomore","onLoad","console","onReachBottom","onUnload","methods","onSearch","createFuzzyRegex","mergeAlternately","acc","result","getlist","uni","title","mask","db","collection","where","limit","get","goodres","key","bookres","list","search","more","Promise","skip","toGoodDetailPage","url","changeCategory","temp","changeSort","compareDesc","compareAsce"],"mappings":"qJAAA,MAGA,aACA,WAFAA,EAAGC,kCAAoCC,EAGvCC,EAAWC,a,+ECLX,iIACIC,EADJ,QASIC,EAAY,qBACd,aACA,YACA,sBACA,EACA,KACA,WACA,MACA,EACA,gBACAD,GAGFC,EAAUC,QAAQC,OAAS,kCACZ,aAAAF,E,yCCvBf,sQ,gCCAA,IAAIG,EAAJ,0LACA,IAAIC,EAAS,WACX,IAAIC,EAAMC,KACNC,EAAKF,EAAIG,eAETC,GADKJ,EAAIK,MAAMC,GACVN,EAAIO,OAAOC,QACpBR,EAAIS,IAAIC,KAAOC,OAAOC,OACpB,GACA,CACEC,MAAO,CACLT,GAAIA,MAKRU,GAAmB,EACnBC,EAAkB,GACtBhB,EAAOiB,eAAgB,G,gCCjBvB,wHAAo0B,eAAG,G,gRCkEv0B,qBACA,aAEA,CACAlB,YACAmB,WAEAP,gBACA,OACAQ,iBACAC,oCACAC,YACAC,SAEA,CACAF,sCACAC,YACAC,SAEA,CACAF,uCACAC,YACAC,SAEA,CACAF,wCACAC,YACAC,SAEA,CACAF,wCACAC,YACAC,SAEA,CACAF,sCACAC,YACAC,SAEA,CACAF,sCACAC,YACAC,UAGAC,aACAF,YACAC,SAEA,CACAD,cACAC,SAEA,CACAD,cACAC,UAGAE,kBACAC,cACAC,aAEAlB,UACAmB,cAEAC,OACAC,YAGAC,mBACAC,uBACA,2BAEA,0BAGAC,yBACAD,wBACA,aAGAE,oBACA,eACA,mBACA,YACA,gBAEAC,SACAC,qBACA,wBACA,uBAGAC,6BAEA,8CAEA,qCAEA,UAGAC,+BACA,gCAKA,OAJAC,eACA,UACAA,aAEA,IACA,IAOA,OAJA,mBACAC,iDAGA,GAGAC,oBAAA,8IAIA,OAHAC,eACAC,YACAC,UACA,kBAIAC,EACAC,oBACAC,OACAJ,8BAEAK,UACAC,MAAA,OANA,OAAAC,SAAA,SAQAL,EACAC,sBACAC,OACAI,4BAEAH,UACAC,MAAA,OAQA,OAdAG,SAOApB,gCAEAqB,oCACArB,2BAEAA,sCACAA,sCACAU,gBAAA,kBACAW,GAAA,qCAEArB,oCAAA,QAEA,OAFA,UAEAU,gBAAA,4EAnCA,IAuCAY,mBAAA,6IAEAH,OAAA,eAOA,OANA,YACA,gBACAT,aACAC,iBACAtB,YACAuB,UACA,0CAIA,oCAEA,YACA,SAEA,+GAlBA,IAqBAW,gBAAA,sJAIA,GAHAb,eACAC,YACAC,YAGA,8CAGA,OADAZ,wBACAU,gBAAA,0BAKA,OADAb,WACAG,yBAAA,mBAGAwB,aACAX,EACAC,oBACAC,OACAJ,wCAEAc,WACAT,UACAC,MACAJ,EACAC,sBACAC,OACAI,sCAEAM,WACAT,UACAC,QACA,QAEA,GAFA,8BAjBAC,OAAAE,OAkBApB,8BACAA,8BAEAkB,sCAAA,gBAEA,OADA,YACAR,gBAAA,4BAGA,sCACA,aAIAW,oCAGA,4BAEA,oEAEAX,gBAAA,qDAEAA,gBACAA,aACAC,eACAtB,YACAuB,UAEAZ,6BAAA,yDA/DA,IAmEA0B,6BAEA,kBAEA,YACA1B,yBACAU,cACAiB,qDAEA,CAEA,YACA3B,yBACAU,cACAiB,kDAIAC,2BACA,eACA,8BAGA,4BAEA,SACA,aAEAC,EADA,WACAA,gCAAA,iBAEAA,gCAAA,yBAGA,gBAIAC,uBACA,eACA,0BAEA,aACA,4CACA,aACA,6CAEA9B,wBACA,6BAEAA,8BAGA+B,wBACA,qBACA,WACA,OACA,aAIAC,wBACA,qBACA,WACA,OACA,gBAIA,c,4EC5XA,wHAA2iD,eAAG,G","file":"pages/search-res/search-res.js","sourcesContent":["import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './pages/search-res/search-res.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./search-res.vue?vue&type=template&id=ba9c7734&scoped=true&\"\nvar renderjs\nimport script from \"./search-res.vue?vue&type=script&lang=js&\"\nexport * from \"./search-res.vue?vue&type=script&lang=js&\"\nimport style0 from \"./search-res.vue?vue&type=style&index=0&id=ba9c7734&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"ba9c7734\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/search-res/search-res.vue\"\nexport default component.exports","export * from \"-!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--17-0!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./search-res.vue?vue&type=template&id=ba9c7734&scoped=true&\"","var components\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var g0 = _vm.resArr.length\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        g0: g0,\n      },\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./search-res.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./search-res.vue?vue&type=script&lang=js&\"","<template>\r\n\t<view class=\"container\">\r\n\t\t<div class=\"search\">\r\n\t\t\t<van-search placeholder=\"请输入搜索关键词\" :value=\"searchKey\" show-action @search=\"onSearch\" bind:cancel=\"onCancel\" />\r\n\t\t</div>\r\n\t\t<block>\r\n\t\t\t<div class=\"dropdown-menu\">\r\n\t\t\t\t<van-dropdown-menu :overlay=\"false\" active-color=\"#ffc300\">\r\n\t\t\t\t\t<van-dropdown-item @change=\"changeCategory\" :value=\"categoryDefault\" :options=\"categoryOption\" />\r\n\t\t\t\t\t<van-dropdown-item @change=\"changeSort\" :value=\"sortDefault\" :options=\"sortOption\" />\r\n\t\t\t\t</van-dropdown-menu>\r\n\t\t\t</div>\r\n\t\t\t<div v-for=\"(item, index) in resArr\" :key=\"index\" class=\"exhibit-goods\" @click=\"toGoodDetailPage(item)\">\r\n\t\t\t\t<div class=\"wrap\">\r\n\t\t\t\t\t<div class=\"left\">\r\n\t\t\t\t\t\t<image class=\"img-good\" :src=\"item.key ? item.bookinfo.pic : item.pics[0].url\" mode=\"aspectFill\" />\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"center\">\r\n\t\t\t\t\t\t<div class=\"top\">\r\n\t\t\t\t\t\t\t<div class=\"desc\">\r\n\t\t\t\t\t\t\t\t{{ item.key ? item.bookinfo.title : item.title }}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div class=\"price\">{{ item.price }}</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"bottom\">\r\n\t\t\t\t\t\t\t<div class=\"label\">\r\n\t\t\t\t\t\t\t\t<div class=\"transport\">\r\n\t\t\t\t\t\t\t\t\t<image class=\"icon-transport\" src=\"../../static/label/transport.svg\" mode=\"\" />\r\n\t\t\t\t\t\t\t\t\t<span\r\n\t\t\t\t\t\t\t\t\t\tclass=\"text-transport\">{{ item.key ? (item.deliveryid == 0 ? \"自提\" : \"配送\") : item.delivery }}</span>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div v-if=\"item.delivery == '自提'\" class=\"address\">\r\n\t\t\t\t\t\t\t\t\t<image class=\"icon-address\" src=\"../../static/label/address.svg\" mode=\"\" />\r\n\t\t\t\t\t\t\t\t\t<span class=\"text-address\">{{ item.place }}</span>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div class=\"quality\">\r\n\t\t\t\t\t\t\t\t\t<image class=\"icon-quality\" src=\"../../static/label/quality.svg\" mode=\"\" />\r\n\t\t\t\t\t\t\t\t\t<span class=\"text-quality\">{{\r\n                    item.key\r\n                      ? item.conditionid == 0\r\n                        ? \"全新\"\r\n                        : item.conditionid == 1\r\n                        ? \"几乎全新\"\r\n                        : item.conditionid == 2\r\n                        ? \"轻微痕迹\"\r\n                        : \"明显痕迹\"\r\n                      : item.condition\r\n                  }}</span>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<block v-if=\"resArr.length === 0\">\r\n\t\t\t\t<div class=\"no-find\">\r\n\t\t\t\t\t<image src=\"../../static/illustration/暂无搜索结果.svg\" mode=\"scaleToFill\" />\r\n\t\t\t\t\t<div class=\"no-find-text\">暂无搜索结果~</div>\r\n\t\t\t\t</div>\r\n\t\t\t</block>\r\n\t\t</block>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\timport VanIcon from \"../../wxcomponents/vant/icon/index\";\r\n\tconst db = wx.cloud.database();\r\n\tconst _ = db.command;\r\n\r\n\texport default {\r\n\t\tcomponents: {\r\n\t\t\tVanIcon\r\n\t\t},\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tcategoryOption: [{\r\n\t\t\t\t\t\ticon: \"/static/category-nav/all.svg\",\r\n\t\t\t\t\t\ttext: \"全部商品\",\r\n\t\t\t\t\t\tvalue: 0,\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ticon: \"/static/category-nav/books.svg\",\r\n\t\t\t\t\t\ttext: \"书籍资料\",\r\n\t\t\t\t\t\tvalue: 1,\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ticon: \"/static/category-nav/iphone.svg\",\r\n\t\t\t\t\t\ttext: \"电子产品\",\r\n\t\t\t\t\t\tvalue: 2,\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ticon: \"/static/category-nav/fitness.svg\",\r\n\t\t\t\t\t\ttext: \"健身器材\",\r\n\t\t\t\t\t\tvalue: 3,\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ticon: \"/static/category-nav/clothes.svg\",\r\n\t\t\t\t\t\ttext: \"服装服饰\",\r\n\t\t\t\t\t\tvalue: 4,\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ticon: \"/static/category-nav/brush.svg\",\r\n\t\t\t\t\t\ttext: \"美妆日化\",\r\n\t\t\t\t\t\tvalue: 5,\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ticon: \"/static/category-nav/other.svg\",\r\n\t\t\t\t\t\ttext: \"其他宝贝\",\r\n\t\t\t\t\t\tvalue: 6,\r\n\t\t\t\t\t},\r\n\t\t\t\t],\r\n\t\t\t\tsortOption: [{\r\n\t\t\t\t\t\ttext: \"默认排序\",\r\n\t\t\t\t\t\tvalue: 0\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttext: \"价格由高到低\",\r\n\t\t\t\t\t\tvalue: 1\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttext: \"价格由低到高\",\r\n\t\t\t\t\t\tvalue: 2\r\n\t\t\t\t\t},\r\n\t\t\t\t],\r\n\t\t\t\tcategoryDefault: 0,\r\n\t\t\t\tsortDefault: 0,\r\n\t\t\t\tsearchKey: \"\",\r\n\r\n\t\t\t\tresArr: [],\r\n\t\t\t\tresArrTemp: [],\r\n\r\n\t\t\t\tpage: 0,\r\n\t\t\t\tnomore: false,\r\n\t\t\t};\r\n\t\t},\r\n\t\tonLoad: function(option) {\r\n\t\t\tconsole.log(\"搜索关键字\" + option); //打印出上个页面传递的搜索关键字参数。\r\n\t\t\tthis.searchKey = option.searchKey;\r\n\r\n\t\t\tthis.search(option.searchKey);\r\n\t\t},\r\n\t\t// 监测页面到底\r\n\t\tonReachBottom() {\r\n\t\t\tconsole.log(\"到底了 :>> \");\r\n\t\t\tthis.more();\r\n\t\t},\r\n\t\t// 监听页面卸载\r\n\t\tonUnload() {\r\n\t\t\tthis.resArr = [];\r\n\t\t\tthis.resArrTemp = [];\r\n\t\t\tthis.page = 0;\r\n\t\t\tthis.nomore = false;\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\tonSearch(e) {\r\n\t\t\t\tthis.searchKey = e.detail;\r\n\t\t\t\tthis.search(e.detail);\r\n\t\t\t},\r\n\t\t\t// 构造匹配规则的正则表达式\r\n\t\t\tcreateFuzzyRegex(query) {\r\n\t\t\t\t// 将输入的查询字符串进行转义，防止其中包含正则表达式元字符\r\n\t\t\t\tconst escapedQuery = query.replace(/[.*+?^${}()|[\\]\\\\]/g, \"\\\\$&\");\r\n\t\t\t\t// 构建模糊查询的正则表达式\r\n\t\t\t\tconst fuzzyRegex = new RegExp(escapedQuery.split(\"\").join(\".*\"));\r\n\r\n\t\t\t\treturn fuzzyRegex;\r\n\t\t\t},\r\n\t\t\t// 合并两个数组(交替进行)\r\n\t\t\tmergeAlternately(arr1, arr2) {\r\n\t\t\t\tlet result = arr1.reduce((acc, val, i) => {\r\n\t\t\t\t\tacc.push(val);\r\n\t\t\t\t\tif (arr2[i] !== undefined) {\r\n\t\t\t\t\t\tacc.push(arr2[i]);\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn acc;\r\n\t\t\t\t}, []);\r\n\r\n\t\t\t\t// 如果 arr2 的长度大于 arr1，将剩余的元素添加到结果中\r\n\t\t\t\tif (arr2.length > arr1.length) {\r\n\t\t\t\t\tresult.push(...arr2.slice(arr1.length));\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn result;\r\n\t\t\t},\r\n\t\t\t// 模糊查询获取商品列表\r\n\t\t\tasync getlist(key) {\r\n\t\t\t\tuni.showLoading({\r\n\t\t\t\t\ttitle: \"加载中\",\r\n\t\t\t\t\tmask: true,\r\n\t\t\t\t});\r\n\r\n\t\t\t\ttry {\r\n\t\t\t\t\t// 使用模糊查询获取商品列表\r\n\t\t\t\t\tconst goodres = await db\r\n\t\t\t\t\t\t.collection(\"goods\")\r\n\t\t\t\t\t\t.where({\r\n\t\t\t\t\t\t\ttitle: this.createFuzzyRegex(key),\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.limit(10)\r\n\t\t\t\t\t\t.get();\r\n\t\t\t\t\t// 图书列表\r\n\t\t\t\t\tconst bookres = await db\r\n\t\t\t\t\t\t.collection(\"publish\")\r\n\t\t\t\t\t\t.where({\r\n\t\t\t\t\t\t\tkey: this.createFuzzyRegex(key),\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.limit(10)\r\n\t\t\t\t\t\t.get();\r\n\t\t\t\t\tconsole.log(\"tets :>> \", \"tets\");\r\n\t\t\t\t\t// 合并数组\r\n\t\t\t\t\tconst list = this.mergeAlternately(goodres.data, bookres.data);\r\n\t\t\t\t\tconsole.log(\"list :>> \", list);\r\n\r\n\t\t\t\t\tconsole.log(\"模糊查询获取商品成功 :>> \", goodres.data);\r\n\t\t\t\t\tconsole.log(\"模糊查询获取书籍成功 :>> \", bookres.data);\r\n\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\treturn list;\r\n\t\t\t\t} catch (error) {\r\n\t\t\t\t\tconsole.log(\"模糊查询获取商品失败 :>> \", error);\r\n\t\t\t\t} finally {\r\n\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// 执行搜索\r\n\t\t\tasync search(key) {\r\n\t\t\t\t// 对key进行判空\r\n\t\t\t\tif (key == \"\") {\r\n\t\t\t\t\tthis.resArr = [];\r\n\t\t\t\t\tthis.resArrTemp = [];\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: \"请输入搜索关键字\",\r\n\t\t\t\t\t\ticon: \"none\",\r\n\t\t\t\t\t\tmask: true,\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t// 搜索\r\n\t\t\t\tthis.resArr = await this.getlist(key);\r\n\t\t\t\t// 重置页数和更多的状态\r\n\t\t\t\tthis.nomore = false;\r\n\t\t\t\tthis.page = 0;\r\n\t\t\t\t// 备份数组\r\n\t\t\t\tthis.resArrTemp = this.resArr?.slice() || [];\r\n\t\t\t},\r\n\t\t\t// 加载更多\r\n\t\t\tasync more() {\r\n\t\t\t\tuni.showLoading({\r\n\t\t\t\t\ttitle: \"加载中\",\r\n\t\t\t\t\tmask: true,\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif (this.nomore || this.resArr.length < 10) {\r\n\t\t\t\t\t// 没有更多\r\n\t\t\t\t\tconsole.log(\"进来了 :>> \");\r\n\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst page = this.page + 1;\r\n\t\t\t\tconsole.log(\"test :>> \");\r\n\t\t\t\ttry {\r\n\t\t\t\t\t// 使用 Promise.all 并行获取商品和书籍\r\n\t\t\t\t\tconst [goodres, bookres] = await Promise.all([\r\n\t\t\t\t\t\tdb\r\n\t\t\t\t\t\t.collection(\"goods\")\r\n\t\t\t\t\t\t.where({\r\n\t\t\t\t\t\t\ttitle: this.createFuzzyRegex(this.searchKey),\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.skip(page * 10)\r\n\t\t\t\t\t\t.limit(10)\r\n\t\t\t\t\t\t.get(),\r\n\t\t\t\t\t\tdb\r\n\t\t\t\t\t\t.collection(\"publish\")\r\n\t\t\t\t\t\t.where({\r\n\t\t\t\t\t\t\tkey: this.createFuzzyRegex(this.searchKey),\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.skip(page * 10)\r\n\t\t\t\t\t\t.limit(10)\r\n\t\t\t\t\t\t.get(),\r\n\t\t\t\t\t]);\r\n\t\t\t\t\tconsole.log(\"goodres :>> \", goodres);\r\n\t\t\t\t\tconsole.log(\"bookres :>> \", bookres);\r\n\r\n\t\t\t\t\tif (goodres.data.length === 0 && bookres.data.length === 0) {\r\n\t\t\t\t\t\tthis.nomore = true;\r\n\t\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (goodres.data.length < 10 || bookres.data.length < 10) {\r\n\t\t\t\t\t\tthis.nomore = true;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// 合并数组\r\n\t\t\t\t\tconst list = this.mergeAlternately(goodres.data, bookres.data);\r\n\r\n\t\t\t\t\t// 拼接\r\n\t\t\t\t\tthis.resArr = this.resArr.concat(list);\r\n\t\t\t\t\t// 备份数组\r\n\t\t\t\t\tthis.resArrTemp = this.resArr?.slice() || [];\r\n\r\n\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t} catch (error) {\r\n\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: \"数据加载失败\",\r\n\t\t\t\t\t\ticon: \"none\",\r\n\t\t\t\t\t\tmask: true,\r\n\t\t\t\t\t});\r\n\t\t\t\t\tconsole.error(\"加载更多失败\", error);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\ttoGoodDetailPage(item) {\r\n\t\t\t\t// 判断是商品还是图书\r\n\t\t\t\tif (item.key == undefined) {\r\n\t\t\t\t\t// 商品\r\n\t\t\t\t\tlet goodId = item._id;\r\n\t\t\t\t\tconsole.log(\"跳转 :>> \", item);\r\n\t\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\t\turl: \"/pages/good-detail/good-detail?goodId=\" + goodId,\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// 图书\r\n\t\t\t\t\tlet bookId = item._id;\r\n\t\t\t\t\tconsole.log(\"跳转 :>> \", item);\r\n\t\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\t\turl: \"/pages/book-detail/book-detail?scene=\" + bookId,\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tchangeCategory(e) {\r\n\t\t\t\tconst index = e.detail;\r\n\t\t\t\tconst category = this.categoryOption[index].text;\r\n\r\n\t\t\t\t// 每次切换分类都重置渲染数组为搜索后的数组\r\n\t\t\t\tthis.resArr = this.resArrTemp;\r\n\r\n\t\t\t\tlet temp = [];\r\n\t\t\t\tif (category !== \"全部商品\") {\r\n\t\t\t\t\tif (category === \"书籍资料\") {\r\n\t\t\t\t\t\ttemp = this.resArr.filter((item) => !!item.key);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\ttemp = this.resArr.filter((item) => item.category === category);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// 渲染数组\r\n\t\t\t\t\tthis.resArr = temp;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tchangeSort(e) {\r\n\t\t\t\tlet index = e.detail;\r\n\t\t\t\tlet sortValue = this.sortOption[index].text;\r\n\r\n\t\t\t\tif (sortValue === \"价格由低到高\") {\r\n\t\t\t\t\tthis.resArr.sort(this.compareDesc(\"price\"));\r\n\t\t\t\t} else if (sortValue === \"价格由高到低\") {\r\n\t\t\t\t\tthis.resArr.sort(this.compareAsce(\"price\"));\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconsole.log(\"ret :>> \");\r\n\t\t\t\t\tthis.resArr = this.resArrTemp;\r\n\t\t\t\t}\r\n\t\t\t\tconsole.log(this.resArrTemp);\r\n\t\t\t},\r\n\t\t\t// 升序比较函数（由小到大）\r\n\t\t\tcompareDesc(p) {\r\n\t\t\t\treturn function(m, n) {\r\n\t\t\t\t\tvar a = m[p];\r\n\t\t\t\t\tvar b = n[p];\r\n\t\t\t\t\treturn a - b;\r\n\t\t\t\t};\r\n\t\t\t},\r\n\t\t\t// 降序比较函数\r\n\t\t\tcompareAsce(p) {\r\n\t\t\t\treturn function(m, n) {\r\n\t\t\t\t\tvar a = m[p];\r\n\t\t\t\t\tvar b = n[p];\r\n\t\t\t\t\treturn b - a;\r\n\t\t\t\t};\r\n\t\t\t},\r\n\t\t},\r\n\t};\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n\t.container {\r\n\t\tpadding: 0 30rpx;\r\n\t\tmin-height: 100vh;\r\n\t\tbackground-color: #f0f0f0;\r\n\r\n\t\t.search {\r\n\t\t\tpadding-top: 20rpx;\r\n\t\t}\r\n\r\n\t\t.dropdown-menu {\r\n\t\t\tmargin: 40rpx 0 0;\r\n\t\t}\r\n\r\n\t\t/deep/ .van-search {\r\n\t\t\tpadding: 0;\r\n\t\t\tbackground-color: #f0f0f0 !important;\r\n\t\t}\r\n\r\n\t\t.exhibit-goods {\r\n\t\t\tmargin: 30rpx 0 0;\r\n\r\n\t\t\t.wrap {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\theight: 200rpx;\r\n\t\t\t\tborder-radius: 20rpx;\r\n\t\t\t\tbackground-color: #fff;\r\n\r\n\t\t\t\t.left {\r\n\t\t\t\t\tpadding: 20rpx;\r\n\r\n\t\t\t\t\t.img-good {\r\n\t\t\t\t\t\twidth: 160rpx;\r\n\t\t\t\t\t\theight: 160rpx;\r\n\t\t\t\t\t\tborder-radius: 10rpx;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t.center {\r\n\t\t\t\t\tpadding-right: 20rpx;\r\n\t\t\t\t\twidth: 100%;\r\n\r\n\t\t\t\t\t.top {\r\n\t\t\t\t\t\tmargin-top: 20rpx;\r\n\r\n\t\t\t\t\t\t.desc {\r\n\t\t\t\t\t\t\tdisplay: -webkit-box;\r\n\t\t\t\t\t\t\toverflow: hidden;\r\n\t\t\t\t\t\t\t-webkit-box-orient: vertical;\r\n\t\t\t\t\t\t\tmin-height: 66rpx;\r\n\t\t\t\t\t\t\ttext-overflow: ellipsis;\r\n\t\t\t\t\t\t\tfont-weight: 500;\r\n\t\t\t\t\t\t\tfont-size: 26rpx;\r\n\r\n\t\t\t\t\t\t\t-webkit-line-clamp: 2;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t.price {\r\n\t\t\t\t\t\t\tpadding: 10rpx 0 0;\r\n\t\t\t\t\t\t\tcolor: #d43f3f;\r\n\t\t\t\t\t\t\tfont-weight: bold;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t.bottom {\r\n\t\t\t\t\t\tdisplay: flex;\r\n\t\t\t\t\t\tjustify-content: space-between;\r\n\r\n\t\t\t\t\t\t.label {\r\n\t\t\t\t\t\t\tposition: relative;\r\n\t\t\t\t\t\t\tdisplay: flex;\r\n\t\t\t\t\t\t\talign-items: center;\r\n\t\t\t\t\t\t\theight: 40rpx;\r\n\t\t\t\t\t\t\tfont-weight: bolder;\r\n\t\t\t\t\t\t\tfont-size: 16.02rpx;\r\n\r\n\t\t\t\t\t\t\t.transport {\r\n\t\t\t\t\t\t\t\tdisplay: flex;\r\n\t\t\t\t\t\t\t\talign-items: center;\r\n\t\t\t\t\t\t\t\tjustify-content: center;\r\n\t\t\t\t\t\t\t\tmargin-top: 4rpx;\r\n\t\t\t\t\t\t\t\tmargin-right: 15rpx;\r\n\t\t\t\t\t\t\t\theight: 30rpx;\r\n\t\t\t\t\t\t\t\tborder-radius: 5rpx;\r\n\t\t\t\t\t\t\t\tbackground-color: #4da4e2;\r\n\r\n\t\t\t\t\t\t\t\t.text-transport {\r\n\t\t\t\t\t\t\t\t\tmargin: 10rpx;\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t.icon-transport {\r\n\t\t\t\t\t\t\t\t\tmargin-left: 10rpx;\r\n\t\t\t\t\t\t\t\t\twidth: 19.28rpx;\r\n\t\t\t\t\t\t\t\t\theight: 19.28rpx;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t.address {\r\n\t\t\t\t\t\t\t\tdisplay: flex;\r\n\t\t\t\t\t\t\t\talign-items: center;\r\n\t\t\t\t\t\t\t\tjustify-content: center;\r\n\t\t\t\t\t\t\t\tmargin-top: 4rpx;\r\n\t\t\t\t\t\t\t\tmargin-right: 15rpx;\r\n\t\t\t\t\t\t\t\theight: 30rpx;\r\n\t\t\t\t\t\t\t\tborder-radius: 5rpx;\r\n\t\t\t\t\t\t\t\tbackground-color: #ffc300;\r\n\r\n\t\t\t\t\t\t\t\t.text-address {\r\n\t\t\t\t\t\t\t\t\tmargin: 10rpx;\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t.icon-address {\r\n\t\t\t\t\t\t\t\t\tmargin-left: 10rpx;\r\n\t\t\t\t\t\t\t\t\twidth: 19.28rpx;\r\n\t\t\t\t\t\t\t\t\theight: 19.28rpx;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t.quality {\r\n\t\t\t\t\t\t\t\tdisplay: flex;\r\n\t\t\t\t\t\t\t\talign-items: center;\r\n\t\t\t\t\t\t\t\tjustify-content: center;\r\n\t\t\t\t\t\t\t\tmargin-top: 4rpx;\r\n\t\t\t\t\t\t\t\tmargin-right: 15rpx;\r\n\t\t\t\t\t\t\t\theight: 30rpx;\r\n\t\t\t\t\t\t\t\tborder-radius: 5rpx;\r\n\t\t\t\t\t\t\t\tbackground-color: #ffc300;\r\n\r\n\t\t\t\t\t\t\t\t.text-quality {\r\n\t\t\t\t\t\t\t\t\tmargin: 10rpx;\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t.icon-quality {\r\n\t\t\t\t\t\t\t\t\tmargin-left: 10rpx;\r\n\t\t\t\t\t\t\t\t\twidth: 17.52rpx;\r\n\t\t\t\t\t\t\t\t\theight: 17.52rpx;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t.browse {\r\n\t\t\t\t\t\t\tdisplay: flex;\r\n\t\t\t\t\t\t\talign-items: center;\r\n\t\t\t\t\t\t\tpadding-right: 40rpx;\r\n\r\n\t\t\t\t\t\t\t.icon-eye {\r\n\t\t\t\t\t\t\t\tpadding-right: 10rpx;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t.num {\r\n\t\t\t\t\t\t\t\ttext-align: center;\r\n\t\t\t\t\t\t\t\tfont-size: 20rpx;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t.right {\r\n\t\t\t\t\tdisplay: flex;\r\n\r\n\t\t\t\t\talign-items: center;\r\n\t\t\t\t\twidth: 50rpx;\r\n\t\t\t\t\tborder-radius: 0 20rpx 20rpx 0;\r\n\t\t\t\t\tbackground-color: #292929;\r\n\r\n\t\t\t\t\t.arrow_left {\r\n\t\t\t\t\t\twidth: 52rpx;\r\n\t\t\t\t\t\theight: 52rpx;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t.no-find {\r\n\t\t\tdisplay: flex;\r\n\t\t\talign-items: center;\r\n\t\t\tflex-direction: column;\r\n\r\n\t\t\t.no-find-text {\r\n\t\t\t\tfont-style: italic;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</style>","import mod from \"-!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./search-res.vue?vue&type=style&index=0&id=ba9c7734&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./search-res.vue?vue&type=style&index=0&id=ba9c7734&lang=scss&scoped=true&\""],"sourceRoot":""}