{"version":3,"sources":["uni-app:///main.js","webpack:///D:/My-Document/projects/WanBig/pages/auditor/auditor.vue?2481","webpack:///D:/My-Document/projects/WanBig/pages/auditor/auditor.vue?e081","webpack:///D:/My-Document/projects/WanBig/pages/auditor/auditor.vue?0a29","webpack:///D:/My-Document/projects/WanBig/pages/auditor/auditor.vue?f47e","uni-app:///pages/auditor/auditor.vue","webpack:///D:/My-Document/projects/WanBig/pages/auditor/auditor.vue?9ab0"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","renderjs","component","options","__file","components","uniSection","uniLoadMore","uniPopup","uniPopupDialog","uniIcons","e","message","indexOf","console","error","render","_vm","this","_h","$createElement","l0","_self","_c","__map","goodsInfo","item","index","$orig","__get_orig","g0","checkedArr","includes","String","m0","g1","$mp","data","Object","assign","$root","recyclableRender","staticRenderFns","_withStripped","isAuditorRadio","isChecked","allChecked","status","isEnd","page","reason","contentText","contentdown","contentrefresh","contentnomore","onLoad","methods","inputDialogToggle","currentItem","dialogInputConfirm","AuditedNoPass","uni","title","mask","pass","note","arr","clickLoadMore","changeCheckbox","allChoose","getNoAudited","db","audited","list","initList","batchOperation","icon","indexs","selectedGoods","unselectedGoods","recodeFails","i","itemRes","updateAudite","res","collection","doc","update","sendAuditResultNotice","riseTime","auditTime","callFunction","name","openid","goodId","goodName","auditResults","then","catch"],"mappings":"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","file":"pages/auditor/auditor.js","sourcesContent":["import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './pages/auditor/auditor.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./auditor.vue?vue&type=template&id=244e8704&scoped=true&\"\nvar renderjs\nimport script from \"./auditor.vue?vue&type=script&lang=js&\"\nexport * from \"./auditor.vue?vue&type=script&lang=js&\"\nimport style0 from \"./auditor.vue?vue&type=style&index=0&id=244e8704&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"244e8704\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/auditor/auditor.vue\"\nexport default component.exports","export * from \"-!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--17-0!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./auditor.vue?vue&type=template&id=244e8704&scoped=true&\"","var components\ntry {\n  components = {\n    uniSection: function () {\n      return import(\n        /* webpackChunkName: \"uni_modules/uni-section/components/uni-section/uni-section\" */ \"@/uni_modules/uni-section/components/uni-section/uni-section.vue\"\n      )\n    },\n    uniLoadMore: function () {\n      return import(\n        /* webpackChunkName: \"uni_modules/uni-load-more/components/uni-load-more/uni-load-more\" */ \"@/uni_modules/uni-load-more/components/uni-load-more/uni-load-more.vue\"\n      )\n    },\n    uniPopup: function () {\n      return import(\n        /* webpackChunkName: \"uni_modules/uni-popup/components/uni-popup/uni-popup\" */ \"@/uni_modules/uni-popup/components/uni-popup/uni-popup.vue\"\n      )\n    },\n    uniPopupDialog: function () {\n      return import(\n        /* webpackChunkName: \"uni_modules/uni-popup/components/uni-popup-dialog/uni-popup-dialog\" */ \"@/uni_modules/uni-popup/components/uni-popup-dialog/uni-popup-dialog.vue\"\n      )\n    },\n    uniIcons: function () {\n      return import(\n        /* webpackChunkName: \"uni_modules/uni-icons/components/uni-icons/uni-icons\" */ \"@/uni_modules/uni-icons/components/uni-icons/uni-icons.vue\"\n      )\n    },\n  }\n} catch (e) {\n  if (\n    e.message.indexOf(\"Cannot find module\") !== -1 &&\n    e.message.indexOf(\".vue\") !== -1\n  ) {\n    console.error(e.message)\n    console.error(\"1. 排查组件名称拼写是否正确\")\n    console.error(\n      \"2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom\"\n    )\n    console.error(\n      \"3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件\"\n    )\n  } else {\n    throw e\n  }\n}\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var l0 = _vm.__map(_vm.goodsInfo, function (item, index) {\n    var $orig = _vm.__get_orig(item)\n    var g0 = _vm.checkedArr.includes(String(index))\n    var m0 = String(index)\n    var g1 = _vm.checkedArr.includes(String(index))\n    return {\n      $orig: $orig,\n      g0: g0,\n      m0: m0,\n      g1: g1,\n    }\n  })\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        l0: l0,\n      },\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./auditor.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./auditor.vue?vue&type=script&lang=js&\"","<template>\r\n\t<div>\r\n\t\t<!-- 待审核section -->\r\n\t\t<view class=\"section\">\r\n\t\t\t<uni-section class=\"mb-10\" title=\"待审核列表\" type=\"line\" />\r\n\t\t</view>\r\n\t\t<view class=\"xxxbox\"></view>\r\n\r\n\t\t<!-- 主体区域 -->\r\n\t\t<scroll-view scroll-y>\r\n\t\t\t<view>\r\n\t\t\t\t<checkbox-group class=\"block\" @change=\"changeCheckbox\">\r\n\t\t\t\t\t<view v-for=\"(item, index) in goodsInfo\" :key=\"index\" class=\"auditor-card\">\r\n\t\t\t\t\t\t<div class=\"wrap\">\r\n\t\t\t\t\t\t\t<div class=\"left\">\r\n\t\t\t\t\t\t\t\t<checkbox :value=\"String(index)\" :checked=\"checkedArr.includes(String(index))\"\r\n\t\t\t\t\t\t\t\t\t:class=\"{ checked: checkedArr.includes(String(index)) }\" style=\"transform: scale(0.7)\"></checkbox>\r\n\t\t\t\t\t\t\t\t<image class=\"img-good\" :src=\"item.pics[0].url\" mode=\"aspectFill\" />\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div class=\"center\">\r\n\t\t\t\t\t\t\t\t<div class=\"top\">\r\n\t\t\t\t\t\t\t\t\t<div class=\"desc\">\r\n\t\t\t\t\t\t\t\t\t\t{{ item.title }}\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<div class=\"price\">{{ item.price }}</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div class=\"bottom\">\r\n\t\t\t\t\t\t\t\t\t<div class=\"label\">\r\n\t\t\t\t\t\t\t\t\t\t<div class=\"transport\">\r\n\t\t\t\t\t\t\t\t\t\t\t<image class=\"icon-transport\" src=\"../../static/label/transport.svg\" mode=\"\" />\r\n\t\t\t\t\t\t\t\t\t\t\t<span class=\"text-transport\">{{ item.delivery }}</span>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t<div class=\"address\" v-if=\"item.delivery === '自提'\">\r\n\t\t\t\t\t\t\t\t\t\t\t<image class=\"icon-address\" src=\"../../static/label/address.svg\" mode=\"\" />\r\n\t\t\t\t\t\t\t\t\t\t\t<span class=\"text-address\">{{ item.place }}</span>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t<div class=\"quality\">\r\n\t\t\t\t\t\t\t\t\t\t\t<image class=\"icon-quality\" src=\"../../static/label/quality.svg\" mode=\"\" />\r\n\t\t\t\t\t\t\t\t\t\t\t<span class=\"text-quality\">{{ item.condition }}</span>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div class=\"right\">\r\n\t\t\t\t\t\t\t\t<van-icon name=\"delete-o\" @click=\"inputDialogToggle(item)\" size=\"40rpx\" color=\"red\" />\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</checkbox-group>\r\n\t\t\t</view>\r\n\t\t\t<uni-load-more color=\"#007AFF\" :status=\"status\" @clickLoadMore=\"clickLoadMore\" :contentText=\"contentText\" />\r\n\t\t</scroll-view>\r\n\r\n\t\t<!-- 审核不通过原因-输入框 -->\r\n\t\t<uni-popup ref=\"inputDialog\" type=\"dialog\">\r\n\t\t\t<uni-popup-dialog ref=\"inputClose\" mode=\"input\" title=\"请输入不通过的原因\" value=\"\" placeholder=\"确认后将立即执行操作\"\r\n\t\t\t\t@confirm=\"dialogInputConfirm\"></uni-popup-dialog>\r\n\t\t</uni-popup>\r\n\r\n\t\t<!-- 全选+批量 操作栏 -->\r\n\t\t<div class=\"select-all\">\r\n\t\t\t<div class=\"left\">\r\n\t\t\t\t<checkbox-group @change=\"allChoose\">\r\n\t\t\t\t\t<label>\r\n\t\t\t\t\t\t<checkbox value=\"all\" :class=\"{ checked: allChecked }\" :checked=\"allChecked ? true : false\"\r\n\t\t\t\t\t\t\tstyle=\"transform: scale(0.7)\"></checkbox>\r\n\t\t\t\t\t\t全选\r\n\t\t\t\t\t</label>\r\n\t\t\t\t</checkbox-group>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"right\">\r\n\t\t\t\t<button size=\"mini\" type=\"primary\" hover-class=\"button-hover\" @click=\"batchOperation(true)\">\r\n\t\t\t\t\t<uni-icons type=\"checkmarkempty\" color=\"#fff\" size=\"24\" />通过\r\n\t\t\t\t</button>\r\n\t\t\t\t<button size=\"mini\" type=\"warn\" hover-class=\"button-hover\" @click=\"batchOperation(false)\">\r\n\t\t\t\t\t<uni-icons type=\"closeempty\" color=\"#fff\" size=\"24\" />不通过\r\n\t\t\t\t</button>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n</template>\r\n\r\n<script>\r\n\tconst db = wx.cloud.database();\r\n\tvar util = require(\"../utils/formatTimeToChinese.js\");\r\n\timport truncatedString from \"../utils/truncatedString.js\";\r\n\tconst _ = db.command;\r\n\tlet isAll = false;\r\n\tlet currentItem = null;\r\n\texport default {\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tgoodsInfo: [],\r\n\r\n\t\t\t\tisAuditorRadio: false,\r\n\t\t\t\tisChecked: false,\r\n\t\t\t\tcheckedArr: [], //复选框选中的值\r\n\t\t\t\tallChecked: false, //是否全选，\r\n\t\t\t\tstatus: \"loading\",\r\n\t\t\t\tisEnd: false,\r\n\t\t\t\tpage: 0,\r\n\t\t\t\treason: \"\",\r\n\t\t\t\tcontentText: {\r\n\t\t\t\t\tcontentdown: \"点击获取更多\",\r\n\t\t\t\t\tcontentrefresh: \"正在加载\",\r\n\t\t\t\t\tcontentnomore: \"没有更多数据了\",\r\n\t\t\t\t},\r\n\t\t\t};\r\n\t\t},\r\n\t\tasync onLoad() {\r\n\t\t\tawait this.initList();\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\t// 打开输入对话框\r\n\t\t\tinputDialogToggle(item) {\r\n\t\t\t\tthis.$refs.inputDialog.open();\r\n\t\t\t\tcurrentItem = item;\r\n\t\t\t},\r\n\t\t\t// 确然输入内容触发的函数\r\n\t\t\tdialogInputConfirm(val, item) {\r\n\t\t\t\tthis.reason = val;\r\n\t\t\t\tthis.$refs.inputDialog.close();\r\n\t\t\t\tthis.AuditedNoPass(currentItem, val);\r\n\t\t\t},\r\n\t\t\t// 单个不过审操作\r\n\t\t\tasync AuditedNoPass(item, reason = \"\") {\r\n\t\t\t\tuni.showLoading({\r\n\t\t\t\t\ttitle: \"正在操作\",\r\n\t\t\t\t\tmask: true,\r\n\t\t\t\t});\r\n\t\t\t\tconsole.log(\"item :>> \", item);\r\n\t\t\t\tconsole.log(\"reason :>> \", reason);\r\n\t\t\t\tawait this.updateAudite(item, false, reason);\r\n\r\n\t\t\t\t// 发送通知用户该审核不通过\r\n\t\t\t\tlet pass = \"不通过\";\r\n\t\t\t\tlet note = `${reason}，请整改后重新发布`;\r\n\t\t\t\tawait this.sendAuditResultNotice(item, pass, note, false); //单项操作，不是批量操作\r\n\r\n\t\t\t\t// 在当前数组中删除该项\r\n\t\t\t\tthis.goodsInfo.forEach((element, index, arr) => {\r\n\t\t\t\t\tif (element._id === item._id) {\r\n\t\t\t\t\t\tconsole.log(\"删除当前项\", element._id);\r\n\t\t\t\t\t\tarr.splice(index, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tconsole.log(this.goodsInfo);\r\n\t\t\t\tuni.hideLoading();\r\n\t\t\t},\r\n\t\t\t// 加载更多\r\n\t\t\tclickLoadMore(e) {\r\n\t\t\t\tconsole.log(\"加载更多 :>> \", e);\r\n\t\t\t\tif (isAll) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tthis.getNoAudited();\r\n\t\t\t},\r\n\t\t\t// 多选复选框改变事件\r\n\t\t\tchangeCheckbox(e) {\r\n\t\t\t\tconsole.log(\"change   :>> \", e);\r\n\t\t\t\tthis.checkedArr = e.detail.value;\r\n\t\t\t\t// 如果选择的数组中有值，并且长度等于列表的长度，就是全选\r\n\t\t\t\tif (this.checkedArr.length > 0 && this.checkedArr.length == this.goodsInfo.length) {\r\n\t\t\t\t\tthis.allChecked = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.allChecked = false;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// 全选事件\r\n\t\t\tallChoose(e) {\r\n\t\t\t\tconsole.log(\"全选 :>> \", e);\r\n\t\t\t\tlet chooseItem = e.detail.value;\r\n\t\t\t\t// 全选\r\n\t\t\t\tif (chooseItem[0] == \"all\") {\r\n\t\t\t\t\tthis.allChecked = true;\r\n\r\n\t\t\t\t\tfor (let i = 0; i < this.goodsInfo.length; i++) {\r\n\t\t\t\t\t\tlet itemVal = String(i);\r\n\t\t\t\t\t\tif (!this.checkedArr.includes(itemVal)) {\r\n\t\t\t\t\t\t\tthis.checkedArr.push(itemVal);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// 取消全选\r\n\t\t\t\t\tthis.allChecked = false;\r\n\t\t\t\t\tthis.checkedArr = [];\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// 获取未审核商品数据\r\n\t\t\tasync getNoAudited() {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tconst {\r\n\t\t\t\t\t\tdata\r\n\t\t\t\t\t} = await db.collection(\"goods\").where({\r\n\t\t\t\t\t\taudited: false\r\n\t\t\t\t\t}).skip(this.page).limit(2).get();\r\n\t\t\t\t\tlet list = this.goodsInfo;\r\n\t\t\t\t\tlist = list.concat(data);\r\n\t\t\t\t\tthis.page += data.length;\r\n\t\t\t\t\tthis.setData({\r\n\t\t\t\t\t\tgoodsInfo: list,\r\n\t\t\t\t\t\tstatus: data.length < 2 ? \"noMore\" : \"more\",\r\n\t\t\t\t\t});\r\n\t\t\t\t} catch (err) {\r\n\t\t\t\t\tconsole.error(\"Error fetching data:\", err);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// 初始化获取未审核商品数据\r\n\t\t\tasync initList() {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tconst {\r\n\t\t\t\t\t\tdata\r\n\t\t\t\t\t} = await db.collection(\"goods\").where({\r\n\t\t\t\t\t\taudited: false\r\n\t\t\t\t\t}).limit(2).get();\r\n\t\t\t\t\tconsole.log(\"data.length, :>> \", data.length);\r\n\t\t\t\t\tthis.goodsInfo = data;\r\n\t\t\t\t\tthis.status = data.length >= 2 ? \"more\" : \"noMore\";\r\n\t\t\t\t\tthis.page += data.length;\r\n\t\t\t\t} catch (err) {\r\n\t\t\t\t\tconsole.error(\"Error fetching data:\", err);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// 批量操作\r\n\t\t\tasync batchOperation(type) {\r\n\t\t\t\t// 判空\r\n\t\t\t\tif (this.checkedArr.length === 0) {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: \"请勾选一项\",\r\n\t\t\t\t\t\ticon: \"error\",\r\n\t\t\t\t\t\tmask: true,\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tuni.showLoading({\r\n\t\t\t\t\ttitle: \"正在处理\",\r\n\t\t\t\t\tmask: true,\r\n\t\t\t\t});\r\n\t\t\t\t// 选择的索引\r\n\t\t\t\tconst indexs = this.checkedArr.map((item) => parseInt(item, 10));\r\n\t\t\t\t// 选择的商品\r\n\t\t\t\tconst selectedGoods = indexs.map((index) => this.goodsInfo[index]);\r\n\t\t\t\t// 未选择的商品\r\n\t\t\t\tconst unselectedGoods = this.goodsInfo.filter((item, index) => {\r\n\t\t\t\t\tif (!indexs.includes(index)) {\r\n\t\t\t\t\t\treturn item;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tconsole.log(indexs);\r\n\t\t\t\tconsole.log(\"选择的good\", selectedGoods);\r\n\t\t\t\tconsole.log(\"未选择的good\", unselectedGoods);\r\n\r\n\t\t\t\t// 批量审核\r\n\t\t\t\tlet pass = type ? \"通过\" : \"不通过\";\r\n\t\t\t\tlet note = type ? \"快叫上小伙伴来一起发布闲置品吧\" : \"内容违规，请整改后重新发布\";\r\n\t\t\t\tlet recodeFails = [];\r\n\r\n\t\t\t\tfor (let i = 0; i < selectedGoods.length; i++) {\r\n\t\t\t\t\tconst item = selectedGoods[i];\r\n\t\t\t\t\t// 更新每一项的审核值\r\n\t\t\t\t\tlet itemRes = this.updateAudite(item, type ? true : false);\r\n\t\t\t\t\tif (itemRes) {\r\n\t\t\t\t\t\t// 发送通知用户该审核通过\r\n\t\t\t\t\t\tawait this.sendAuditResultNotice(item, pass, note, true); // 批量操作\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\trecodeFails.push(item);\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// 清空勾选的索引数组和取消全选\r\n\t\t\t\tthis.checkedArr = [];\r\n\t\t\t\tthis.allChecked = false;\r\n\t\t\t\t// 显示剩余的数据和失败的数据\r\n\t\t\t\tthis.goodsInfo = [...unselectedGoods, ...recodeFails];\r\n\t\t\t\tthis.page = this.goodsInfo.length;\r\n\r\n\t\t\t\tuni.hideLoading();\r\n\t\t\t\t// 操作反馈\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: `成功${selectedGoods.length - recodeFails.length},失败${recodeFails.length}`,\r\n\t\t\t\t\tmask: true,\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t// 更新审核状态\r\n\t\t\tasync updateAudite(item, pass, reason = \"\") {\r\n\t\t\t\tlet res = null;\r\n\t\t\t\ttry {\r\n\t\t\t\t\t// 更新audited属性为true，pass属性为false：表示已经审核，但是审核不通过\r\n\t\t\t\t\tres = await db\r\n\t\t\t\t\t\t.collection(\"goods\")\r\n\t\t\t\t\t\t.doc(item._id)\r\n\t\t\t\t\t\t.update({\r\n\t\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\t\taudited: true, // 已经审核\r\n\t\t\t\t\t\t\t\tpass: pass, // 审核状态\r\n\t\t\t\t\t\t\t\treason: reason, // 不通过原因\r\n\t\t\t\t\t\t\t\tstatus: pass ? 0 : -1, // 可售状态\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\tif (res.stats.updated > 0) {\r\n\t\t\t\t\t\tconsole.log(\"更新审核状态成功\", res);\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconsole.log(\"更新审核状态失败\", res);\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch (error) {\r\n\t\t\t\t\tconsole.log(\"更新审核状态出错 :>> \", error);\r\n\t\t\t\t\t// 处理错误情况，例如数据库更新失败\r\n\t\t\t\t\t// throw error; // 抛出错误以供调用者处理\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// 发送审核通知\r\n\t\t\tasync sendAuditResultNotice(item, pass, note, batch) {\r\n\t\t\t\t// 处理时间格式\r\n\t\t\t\tlet riseTime = util.formatTimeToChinese(item.creat);\r\n\t\t\t\tlet auditTime = util.formatTimeToChinese(new Date());\r\n\t\t\t\tconsole.log(riseTime);\r\n\t\t\t\tconsole.log(auditTime);\r\n\r\n\t\t\t\tawait wx.cloud\r\n\t\t\t\t\t.callFunction({\r\n\t\t\t\t\t\tname: \"sendAuditedRes\",\r\n\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\topenid: item._openid, // 字符串\r\n\t\t\t\t\t\t\tgoodId: item._id, // 字符串\r\n\t\t\t\t\t\t\tgoodName: truncatedString(item.title, 20), // 字符串 使用截断\r\n\t\t\t\t\t\t\triseTime: riseTime, // 发起时间    // TODO\r\n\t\t\t\t\t\t\tauditTime: auditTime, // 审核时间\r\n\t\t\t\t\t\t\tauditResults: pass, // 字符串\r\n\t\t\t\t\t\t\tnote: note, // 字符串\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.then((res) => {\r\n\t\t\t\t\t\tconsole.log(\"first response: \", res);\r\n\t\t\t\t\t\tif (res.result.errCode === 43101) {\r\n\t\t\t\t\t\t\tconsole.log(\"用户拒绝接收，允许接收次数已使用完\", res);\r\n\t\t\t\t\t\t\tif (!batch) {\r\n\t\t\t\t\t\t\t\t// 单个操作显示，批量则不显示\r\n\t\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\t\ttitle: \"用户拒绝接收\",\r\n\t\t\t\t\t\t\t\t\ticon: \"error\",\r\n\t\t\t\t\t\t\t\t\tmask: true,\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch((err) => {\r\n\t\t\t\t\t\tconsole.log(\"错误！！！\", err);\r\n\t\t\t\t\t\tconsole.log(\"错误！！！\", err.errCode);\r\n\t\t\t\t\t\tif (err.errCode === -1 && !batch) {\r\n\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\ttitle: \"发送通知成功\",\r\n\t\t\t\t\t\t\t\ticon: \"success\",\r\n\t\t\t\t\t\t\t\tmask: true,\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t},\r\n\t\t},\r\n\t};\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n\t.section {\r\n\t\tposition: fixed;\r\n\t\ttop: 0;\r\n\t\tz-index: 2;\r\n\t\twidth: 100%;\r\n\t}\r\n\r\n\t.xxxbox {\r\n\t\twidth: 100%;\r\n\t\theight: 90rpx;\r\n\t}\r\n\r\n\tscroll-view {\r\n\t\theight: calc(100vh - 130rpx - 90rpx);\r\n\t}\r\n\r\n\t.select-all {\r\n\t\tposition: fixed;\r\n\t\tbottom: 0rpx;\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: space-between;\r\n\t\talign-items: center;\r\n\t\twidth: 100%;\r\n\t\theight: 130rpx;\r\n\t\tfont-size: 30rpx;\r\n\t\tbackground-color: #ffc300;\r\n\t\tborder-radius: 20rpx;\r\n\r\n\t\t.left {\r\n\t\t\tpadding-left: 10rpx;\r\n\t\t\tfont-size: 30rpx;\r\n\t\t\tfont-weight: bold;\r\n\t\t}\r\n\r\n\t\t.right {\r\n\t\t\tdisplay: flex;\r\n\r\n\t\t\tbutton {\r\n\t\t\t\twidth: auto;\r\n\t\t\t\tfont-size: 30rpx;\r\n\t\t\t\tline-height: 70rpx;\r\n\t\t\t\tborder-radius: 50rpx;\r\n\r\n\t\t\t\tuni-icons {\r\n\t\t\t\t\tposition: relative;\r\n\t\t\t\t\tright: 5rpx;\r\n\t\t\t\t\tbottom: -5rpx;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t.wrap {\r\n\t\tdisplay: flex;\r\n\t\theight: 200rpx;\r\n\t\tmargin: 0 10rpx 20rpx;\r\n\t\tbackground-color: #fff;\r\n\t\tbox-shadow: 2rpx 3rpx 10rpx 2rpx rgb(180, 179, 179);\r\n\t\tborder-radius: 20rpx;\r\n\r\n\t\t.left {\r\n\t\t\tdisplay: flex;\r\n\t\t\talign-items: center;\r\n\t\t\tpadding: 20rpx;\r\n\r\n\t\t\t.img-good {\r\n\t\t\t\twidth: 160rpx;\r\n\t\t\t\theight: 160rpx;\r\n\t\t\t\tborder-radius: 10rpx;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t.center {\r\n\t\t\tflex: 1;\r\n\r\n\t\t\t.top {\r\n\t\t\t\tmargin-top: 20rpx;\r\n\r\n\t\t\t\t.desc {\r\n\t\t\t\t\tdisplay: -webkit-box;\r\n\t\t\t\t\toverflow: hidden;\r\n\t\t\t\t\tmin-height: 66rpx;\r\n\t\t\t\t\tfont-size: 26rpx;\r\n\t\t\t\t\tfont-weight: 500;\r\n\t\t\t\t\ttext-overflow: ellipsis;\r\n\r\n\t\t\t\t\t-webkit-box-orient: vertical;\r\n\t\t\t\t\t-webkit-line-clamp: 2;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t.price {\r\n\t\t\t\t\tpadding: 10rpx 0 0;\r\n\t\t\t\t\tcolor: #d43f3f;\r\n\t\t\t\t\tfont-weight: bold;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t.bottom {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tjustify-content: space-between;\r\n\r\n\t\t\t\t.label {\r\n\t\t\t\t\tposition: relative;\r\n\t\t\t\t\tdisplay: flex;\r\n\t\t\t\t\talign-items: center;\r\n\t\t\t\t\theight: 40rpx;\r\n\t\t\t\t\tfont-size: 16.02rpx;\r\n\t\t\t\t\tfont-weight: bolder;\r\n\r\n\t\t\t\t\t.transport {\r\n\t\t\t\t\t\tdisplay: flex;\r\n\t\t\t\t\t\tjustify-content: center;\r\n\t\t\t\t\t\talign-items: center;\r\n\t\t\t\t\t\theight: 30rpx;\r\n\t\t\t\t\t\tmargin-top: 4rpx;\r\n\t\t\t\t\t\tmargin-right: 15rpx;\r\n\t\t\t\t\t\tbackground-color: #4da4e2;\r\n\t\t\t\t\t\tborder-radius: 5rpx;\r\n\r\n\t\t\t\t\t\t.text-transport {\r\n\t\t\t\t\t\t\tmargin: 10rpx;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t.icon-transport {\r\n\t\t\t\t\t\t\twidth: 19.28rpx;\r\n\t\t\t\t\t\t\theight: 19.28rpx;\r\n\t\t\t\t\t\t\tmargin-left: 10rpx;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t.address {\r\n\t\t\t\t\t\tdisplay: flex;\r\n\t\t\t\t\t\tjustify-content: center;\r\n\t\t\t\t\t\talign-items: center;\r\n\t\t\t\t\t\theight: 30rpx;\r\n\t\t\t\t\t\tmargin-top: 4rpx;\r\n\t\t\t\t\t\tmargin-right: 15rpx;\r\n\t\t\t\t\t\tbackground-color: #ffc300;\r\n\t\t\t\t\t\tborder-radius: 5rpx;\r\n\r\n\t\t\t\t\t\t.text-address {\r\n\t\t\t\t\t\t\tmargin: 10rpx;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t.icon-address {\r\n\t\t\t\t\t\t\twidth: 19.28rpx;\r\n\t\t\t\t\t\t\theight: 19.28rpx;\r\n\t\t\t\t\t\t\tmargin-left: 10rpx;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t.quality {\r\n\t\t\t\t\t\tdisplay: flex;\r\n\t\t\t\t\t\tjustify-content: center;\r\n\t\t\t\t\t\talign-items: center;\r\n\t\t\t\t\t\theight: 30rpx;\r\n\t\t\t\t\t\tmargin-top: 4rpx;\r\n\t\t\t\t\t\tmargin-right: 15rpx;\r\n\t\t\t\t\t\tbackground-color: #ffc300;\r\n\t\t\t\t\t\tborder-radius: 5rpx;\r\n\r\n\t\t\t\t\t\t.text-quality {\r\n\t\t\t\t\t\t\tmargin: 10rpx;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t.icon-quality {\r\n\t\t\t\t\t\t\twidth: 17.52rpx;\r\n\t\t\t\t\t\t\theight: 17.52rpx;\r\n\t\t\t\t\t\t\tmargin-left: 10rpx;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t.browse {\r\n\t\t\t\t\tdisplay: flex;\r\n\t\t\t\t\talign-items: center;\r\n\t\t\t\t\tpadding-right: 40rpx;\r\n\r\n\t\t\t\t\t.icon-eye {\r\n\t\t\t\t\t\tpadding-right: 10rpx;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t.num {\r\n\t\t\t\t\t\tfont-size: 20rpx;\r\n\t\t\t\t\t\ttext-align: center;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t.right {\r\n\t\t\tdisplay: flex;\r\n\t\t\tjustify-content: center;\r\n\t\t\talign-items: center;\r\n\t\t\twidth: 80rpx;\r\n\t\t\tbackground-color: #eee;\r\n\t\t\tborder-radius: 0 20rpx 20rpx 0;\r\n\t\t}\r\n\t}\r\n</style>","import mod from \"-!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./auditor.vue?vue&type=style&index=0&id=244e8704&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../uni-app开发工具/HBuilderX.3.3.13.20220314/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./auditor.vue?vue&type=style&index=0&id=244e8704&lang=scss&scoped=true&\""],"sourceRoot":""}