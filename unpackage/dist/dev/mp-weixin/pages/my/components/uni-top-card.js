(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/my/components/uni-top-card"],{183:function(n,e,t){"use strict";t.r(e);var r=t(184),o=t(186);for(var a in o)"default"!==a&&function(n){t.d(e,n,(function(){return o[n]}))}(a);t(188);var c,i=t(14),u=Object(i["default"])(o["default"],r["render"],r["staticRenderFns"],!1,null,"08521d74",null,!1,r["components"],c);u.options.__file="pages/my/components/uni-top-card.vue",e["default"]=u.exports},184:function(n,e,t){"use strict";t.r(e);var r=t(185);t.d(e,"render",(function(){return r["render"]})),t.d(e,"staticRenderFns",(function(){return r["staticRenderFns"]})),t.d(e,"recyclableRender",(function(){return r["recyclableRender"]})),t.d(e,"components",(function(){return r["components"]}))},185:function(n,e,t){"use strict";var r;t.r(e),t.d(e,"render",(function(){return o})),t.d(e,"staticRenderFns",(function(){return c})),t.d(e,"recyclableRender",(function(){return a})),t.d(e,"components",(function(){return r}));var o=function(){var n=this,e=n.$createElement;n._self._c},a=!1,c=[];o._withStripped=!0},186:function(n,e,t){"use strict";t.r(e);var r=t(187),o=t.n(r);for(var a in r)"default"!==a&&function(n){t.d(e,n,(function(){return r[n]}))}(a);e["default"]=o.a},187:function(n,e,t){"use strict";(function(n){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=o(t(9));function o(n){return n&&n.__esModule?n:{default:n}}function a(n,e,t,r,o,a,c){try{var i=n[a](c),u=i.value}catch(s){return void t(s)}i.done?e(u):Promise.resolve(u).then(r,o)}function c(n){return function(){var e=this,t=arguments;return new Promise((function(r,o){var c=n.apply(e,t);function i(n){a(c,r,o,i,u,"next",n)}function u(n){a(c,r,o,i,u,"throw",n)}i(void 0)}))}}var i=function(){t.e("common/vendor").then(function(){return resolve(t(171))}.bind(null,t)).catch(t.oe)},u=wx.cloud.database(),s={data:function(){return{showLogin:!1,nickName:"",avatarUrl:"",Auditor:"",userInfo:{}}},mounted:function(){n.getStorageSync("openid");n.getStorageSync("isRegister")?(this.userInfo=n.getStorageSync("userInfo"),this.renderPage(this.userInfo.nickName,this.userInfo.avatarUrl)):(console.log("数据库中--无该用户的信息"),this.login()),console.log("登录启动")},methods:{toProjectPage:function(){n.navigateTo({url:"/pages/project-info/project-info"})},login:function(){console.log("弹窗一键登录"),this.showLogin=!0},clickOneLogin:function(){var e=this;wx.getSetting({success:function(t){t.authSetting["scope.userInfo"]&&wx.getUserProfile({desc:"登录",success:function(t){var o={nickName:"",avatarUrl:"",dealNum:0,goodsNum:0,isAuditor:!1,vip:!1};o.nickName=t.userInfo.nickName,o.avatarUrl=t.userInfo.avatarUrl,console.log("初始化用户信息",o),e.renderPage(o.nickName,o.avatarUrl),e.userInfo=o,u.collection("user").add({data:{nickName:o.nickName,avatarUrl:o.avatarUrl,vip:!1,isAuditor:!1,dealNum:0,goodsNum:0}}).then(function(){var t=c(r.default.mark((function t(o){var a;return r.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return console.log("将用户信息--存入数据库--成功"),t.next=3,e.getUserInfo();case 3:a=t.sent,n.setStorageSync("userInfo",a),n.setStorageSync("isRegister",!0);case 6:case"end":return t.stop()}}),t)})));return function(n){return t.apply(this,arguments)}}())},fail:function(n){console.log("登录失败",n)}})}})},clickNoLogin:function(){this.showLogin=!1,console.log("用户点击了暂不登录")},onCloseLogin:function(){this.showLogin=!1},renderPage:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"未登录",e=arguments.length>1?arguments[1]:void 0;this.showLogin=!1,this.nickName=n,this.avatarUrl=e},getUserInfo:function(){return c(r.default.mark((function e(){var t;return r.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u.collection("user").where({_openid:n.getStorageSync("openid")}).get();case 3:if(t=e.sent,console.log("获取最新的用户数据",t),!(t.data.length>0)){e.next=10;break}return console.log("heello"),e.abrupt("return",t.data[0]);case 10:return e.abrupt("return",null);case 11:e.next=17;break;case 13:throw e.prev=13,e.t0=e["catch"](0),console.error("获取用户信息失败",e.t0),e.t0;case 17:case"end":return e.stop()}}),e,null,[[0,13]])})))()},isAuditor:function(){var e=this;return c(r.default.mark((function t(){var o;return r.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.getUserInfo();case 3:o=t.sent,o.isAuditor?n.navigateTo({url:"/pages/auditor/auditor"}):wx.showModal({title:"提示",content:"您还不是审核员，请联系作者申请",success:function(n){n.confirm?console.log("用户点击确定"):n.cancel&&console.log("用户点击取消")}}),t.next=10;break;case 7:t.prev=7,t.t0=t["catch"](0),console.log("检查审核员状态失败",t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()}},components:{VanIcon:i}};e.default=s}).call(this,t(1)["default"])},188:function(n,e,t){"use strict";t.r(e);var r=t(189),o=t.n(r);for(var a in r)"default"!==a&&function(n){t.d(e,n,(function(){return r[n]}))}(a);e["default"]=o.a},189:function(n,e,t){}}]);
//# sourceMappingURL=../../../../.sourcemap/mp-weixin/pages/my/components/uni-top-card.js.map
;(global["webpackJsonp"] = global["webpackJsonp"] || []).push([
    'pages/my/components/uni-top-card-create-component',
    {
        'pages/my/components/uni-top-card-create-component':(function(module, exports, __webpack_require__){
            __webpack_require__('1')['createComponent'](__webpack_require__(183))
        })
    },
    [['pages/my/components/uni-top-card-create-component']]
]);
