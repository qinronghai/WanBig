(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/goods-detail/goods-detail"],{101:function(n,o,e){"use strict";(function(n){e(5);t(e(4));var o=t(e(102));function t(n){return n&&n.__esModule?n:{default:n}}wx.__webpack_require_UNI_MP_PLUGIN__=e,n(o.default)}).call(this,e(1)["createPage"])},102:function(n,o,e){"use strict";e.r(o);var t=e(103),r=e(105);for(var c in r)"default"!==c&&function(n){e.d(o,n,(function(){return r[n]}))}(c);e(108);var s,u=e(14),a=Object(u["default"])(r["default"],t["render"],t["staticRenderFns"],!1,null,"23714906",null,!1,t["components"],s);a.options.__file="pages/goods-detail/goods-detail.vue",o["default"]=a.exports},103:function(n,o,e){"use strict";e.r(o);var t=e(104);e.d(o,"render",(function(){return t["render"]})),e.d(o,"staticRenderFns",(function(){return t["staticRenderFns"]})),e.d(o,"recyclableRender",(function(){return t["recyclableRender"]})),e.d(o,"components",(function(){return t["components"]}))},104:function(n,o,e){"use strict";var t;e.r(o),e.d(o,"render",(function(){return r})),e.d(o,"staticRenderFns",(function(){return s})),e.d(o,"recyclableRender",(function(){return c})),e.d(o,"components",(function(){return t}));var r=function(){var n=this,o=n.$createElement;n._self._c},c=!1,s=[];r._withStripped=!0},105:function(n,o,e){"use strict";e.r(o);var t=e(106),r=e.n(t);for(var c in t)"default"!==c&&function(n){e.d(o,n,(function(){return t[n]}))}(c);o["default"]=r.a},106:function(n,o,e){"use strict";(function(n){Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var t=r(e(9));function r(n){return n&&n.__esModule?n:{default:n}}function c(n,o,e,t,r,c,s){try{var u=n[c](s),a=u.value}catch(i){return void e(i)}u.done?o(a):Promise.resolve(a).then(t,r)}function s(n){return function(){var o=this,e=arguments;return new Promise((function(t,r){var s=n.apply(o,e);function u(n){c(s,t,r,u,a,"next",n)}function a(n){c(s,t,r,u,a,"throw",n)}u(void 0)}))}}var u=function(){e.e("common/vendor").then(function(){return resolve(e(245))}.bind(null,e)).catch(e.oe)},a=e(107),i=wx.cloud.database(),d=i.command,l={data:function(){return{good:{},goodId:"",goodsInfo:{},userInfo:""}},components:{VanButton:u},onLoad:function(){var o=s(t.default.mark((function o(e){var r=this;return t.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:console.log("//打印出上个页面传递的参数。",e.goodId),console.log("//打印出上个页面传递的参数。",e.flag),this.goodId=e.goodId,"1"===e.flag?this.goodsInfo=n.getStorageSync("goodsInfoFlag"):this.goodsInfo=n.getStorageSync("goodsInfo"),console.log(this.goodsInfo,"tesdsssssssss"),this.goodsInfo.forEach((function(n){if(n._id===r.goodId){r.good=n,console.log("找到该商品",n),console.log("发布该商品的用户--",n.userInfo);var o=n.userInfo._openid;r.getUserInfo(o)}})),this.updateViews(e),this.render(e.goodId);case 8:case"end":return o.stop()}}),o,this)})));function e(n){return o.apply(this,arguments)}return e}(),onShareAppMessage:function(){},methods:{getUserInfo:function(n){var o=this;return s(t.default.mark((function e(){return t.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,i.collection("user").where({_openid:n}).get().then((function(n){console.log("详情页面----------获取用户信息",n),o.userInfo=n.data[0]}));case 2:case"end":return e.stop()}}),e)})))()},updateViews:function(n){return s(t.default.mark((function o(){return t.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return o.next=2,i.collection("goods").doc(n.goodId).update({data:{views:d.inc(1)},success:function(n){console.log("更新--浏览量--成功",n)}});case 2:case"end":return o.stop()}}),o)})))()},sendBookingSuccessMsg:function(){var n=this;return s(t.default.mark((function o(){var e,r,c,s;return t.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return e=a.formatTime(n.buyTime),r=Date.now(),c=r+1728e5,c=parseInt(c),s=new Date(c),s=a.formatTime(s),console.log("两天后的时间",s),o.next=9,wx.cloud.callFunction({name:"sendBookingSuccessMsg",data:{openid:n.good.userInfo._openid,goodId:n.goodId,orderInfo:n.good.title,startingTime:e,contact:n.good.contact,address:n.good.address,endTime:s}}).then((function(n){console.log("成功发送预定信息",n)})).catch((function(n){console.log("失败发送预定信息",n)}));case 9:case"end":return o.stop()}}),o)})))()},updataBuyTime:function(){var n=this;return s(t.default.mark((function o(){var e;return t.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return n.buyTime=new Date,e=n.good._id,console.log(n.buyTime),o.next=5,i.collection("goods").doc(e).update({data:{buyTime:n.buyTime,buy:!0},success:function(n){console.log("更新--预定时间及状态--成功",n)}});case 5:case"end":return o.stop()}}),o)})))()},popContact:function(){console.log("弹窗联系方式--");var n=this.good.contact,o=this;wx.showModal({title:"联系我~",content:n,success:function(e){e.confirm?(console.log("用户点击确定"),wx.setClipboardData({data:n,success:function(n){wx.getClipboardData({success:function(n){console.log("已成功复制联系方式",n.data),o.updataBuyTime(),o.sendBookingSuccessMsg()}})}})):e.cancel&&console.log("用户点击取消")}})},render:function(n){var o=this;console.log(n),console.log(this.goodsInfo),this.goodsInfo.forEach((function(e){e._id===n&&(o.good=e,console.log("商品详情--该商品--",e),console.log("商品详情--发布该商品的用户--",e.userInfo))}))}}};o.default=l}).call(this,e(1)["default"])},108:function(n,o,e){"use strict";e.r(o);var t=e(109),r=e.n(t);for(var c in t)"default"!==c&&function(n){e.d(o,n,(function(){return t[n]}))}(c);o["default"]=r.a},109:function(n,o,e){}},[[101,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/goods-detail/goods-detail.js.map